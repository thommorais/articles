function pagechanges(a,b,c,d,e){oldportpageno=0;var f=0;var g=false;if(!ignorecardswitch){if(oldcardno==0&&a.getActiveIndex()==2){pageno--;f=pageno-1;g=false}else if(oldcardno<a.getActiveIndex()||a.getActiveIndex()==0&&oldcardno==2){pageno++;f=pageno+1;g=true}else{pageno--;f=pageno-1;g=false}if(pageno==0){pageno=parseInt(lblpages)}if(pageno>parseInt(lblpages))pageno=1;if(islandscape()){if(g){if(parseInt(lblpages)>parseInt(pageno)&&pageno!=1){if(pageno%2==0){pageno++}}}else{if(parseInt(lblpages)>parseInt(pageno)+1){if(pageno%2==0){pageno--}}}}}localStorage.setItem("readeditionguid",lbleditionguid);localStorage.setItem("readpageno",pageno);SetCards(a);ignorecardswitch=false}function IsNumeric(a){return a-0==a&&a.length>0}function supportsToDataURL(){if(!supports_canvas()){return false}var a=document.createElement("canvas");var b=a.toDataURL("image/jpg");return b.indexOf("data:image/jpg")==0}function supports_canvas(){return!!document.createElement("canvas").getContext}function islandscape(){if(widths>heightofpanel){return true}else return false}var imagezoomlevel=1520;var recreatereader=function(){if(pnlPaper){pnlMain.remove(pnlPaper,true)}pnlPaper=new Ext.Panel({id:"Paper",html:"",iconCls:"paper",title:"Paper",hidden:true});hascreatedreader=false;hasinitilised=false;pnlMain.insert(2,pnlPaper)};var DisplayReader=function(){pnlPaper.show()};var resizereader=function(){cache1pageno=-1;cache2pageno=-1;cache3pageno=-1;carind1=-1;carind2=-1;carind3=-1;SetCards(carouselpart);SetUpToolbar()};var CreateToolbar=function(){SetUpToolbar()};var updatesearchresults=function(a,b,c,d){b.update("");b.removeAll(true);b.doLayout();if(targetos=="android"){Searchboxsmall=new Ext.Button({itemId:"Search",width:200,text:"Search again",listeners:{tap:function(a,b){setTimeout("LookForChangedSearch()",100);window.plugins.downloader.searchtexts(function(a){},function(a){})}}});b.add(Searchboxsmall)}b.add({html:" <b>"+(a.getCount()==100?"More than 100":a.getCount())+"</b> results found for '<b>"+(targetos=="android"?c:c.getValue())+"</b>'"});searchsegmentedButton=new Ext.SegmentedButton({defaults:{flex:1},style:"width: 100%;padding-left:0%",items:[{text:"Search Edition",pressed:d=="e"?true:false},{text:"Search Archive",pressed:d=="p"?true:false}],listeners:{toggle:function(a,d,e){if(e){switch(d.text){case"Search Edition":createsearchlarge(c,b,"e");break;case"Search Archive":createsearchlarge(c,b,"p");break}}}}});b.add(searchsegmentedButton);listresults=new Ext.List({itemTpl:'<div style = "float:left;width:130px"><img src = "http://edition.pagesuite-professional.co.uk/get_image.aspx?h=140&eid={eid}&pnum={pnum}&c=50"/></div><div style = "padding-left:10px;float:left;font-size:11pt;width:270px">{name} - Page {pnum}<br>{result}</div><div style = "clear:both"></div>',cls:"myList",store:a,style:"margin-left:2%;margin-right:2%;background-color: Transparent;",id:"MyList",allowDeselect:false,clearSelectionOnDeactivate:true,layout:"fit",height:heightofpanel-117,grouped:false,indexBar:false,singleSelect:true,listeners:{itemtap:function(a,b,c,e){ignoreinitofedition=true;var f=a.store.getAt(b);if(d=="p"){if(startdownloading){DownloadFinished("Disabled")}else{lbleditionguid=f.get("eid");lblname=f.get("name");nextpageno=parseInt(f.get("pnum"));editionstore.data.each(function(){if(this.data["editionguid"]==f.get("eid")){lblpages=this.data["pages"];nopages=this.data["pages"]}});if(supportstabpanel){if(hashomebutton){pnlMain.setActiveItem(2)}else{pnlMain.setActiveItem(1)}}changingarchive=true;OpenDownloadedEdition();isfromdownload=true;if(pnlSearch){pnlSearch.hide();pnlMain.show();if(restorepaper){pnlPaper.show();restorepaper=false}}}}else{if(pnlSearch){pnlSearch.hide();pnlMain.show();if(restorepaper)if(restorepaper){pnlPaper.show();restorepaper=false}}SetPageNo(f.get("pnum"));if(supportstabpanel){if(hashomebutton){pnlMain.setActiveItem(2)}else{pnlMain.setActiveItem(1)}}}}}});b.add(listresults);b.doLayout()};var createsearchlarge=function(a,b,c){b.removeAll(true);b.add({html:'  Searching for "<b>'+(targetos=="android"?a:a.getValue())+'</b>"..........'});b.doLayout();searchstore=new Ext.data.XmlStore({model:"searchinfo",listeners:{datachanged:function(d){disableresize=false;if(initsearch)updatesearchresults(d,b,a,c);initsearch=false}},proxy:{type:"ajax",url:serverprefix+"search.aspx?q="+(targetos=="android"?a:a.getValue())+"&eid="+lbleditionguid+"&t="+c+"&p=0&rp=100&f=100&s=r",reader:new Ext.data.XmlReader({type:"xml",root:"results",record:"result"})}});console.log(serverprefix+"search.aspx?q="+(targetos=="android"?a:a.getValue())+"&eid="+lbleditionguid+"&t="+c+"&p=0&rp=100&f=100&s=r");initsearch=true;setTimeout("LoadResultsInFewSeconds()",1e3)};var LoadResultsInFewSeconds=function(){searchstore.load()};var LookForChangedSearch=function(){window.plugins.downloader.pagenochanged(function(a){if(a!=""){document.addEventListener("backbutton",closeSearch,false);createsearchlarge(a,pnlSearch,searchtype)}else{setTimeout("LookForChangedSearch()",100);document.addEventListener("backbutton",closeSearch,false)}},function(a){})};var LookForChangedValue=function(){window.plugins.downloader.pagenochanged(function(a){if(a!=""){value=parseInt(a);if(value<1)value=1;if(value>nopages)value=nopages;SetPageNo(value);currentpage=value;disableresize=false}else{setTimeout("LookForChangedValue()",100)}},function(a){})};var RequestSearch=function(){if(Searchbox.getValue()!=""){var a=widths-40;if(a>600)a=600;searchpanel=new Ext.Panel({floating:true,id:"searchpanel",modal:true,Createdock:"bottom",height:heightofpanel,hideOnMaskTap:true,width:a,html:"",ui:"light",listeners:{afterrender:function(a){if(Searchbox.getValue()!=""){createsearchlarge(Searchbox,a,"e")}},beforehide:function(a){a.destroy()}}});searchpanel.showBy(Searchbox,true,true)}};var SetUpToolbar=function(){tbar.removeAll(true);if(targetos!="android"){Searchboxsmall=new Ext.form.Search({xtype:"searchfield",itemId:"Search",width:widths,listeners:{focus:function(a,b){disableresize=true},blur:function(a,b){createsearchlarge(a,pnlSearch,"e")}}})}else{Searchboxsmall=new Ext.Button({itemId:"Search",width:200,text:"Enter Search Terms",listeners:{tap:function(a,b){setTimeout("LookForChangedSearch()",100);window.plugins.downloader.searchtexts(function(a){},function(a){})}}})}Searchbox=new Ext.form.Search({xtype:"searchfield",itemId:"Search",width:200,listeners:{focus:function(a,b){disableresize=true},blur:function(a,b){setTimeout("RequestSearch()",1e3)}}});btnmenu=new Ext.Button({itemId:"Share",style:"font-size:"+fontsize+"pt",text:"Menu",ui:"menu",handler:ShowOptions});btnpages=new Ext.Button({itemId:"Pages",style:"font-size:"+fontsize+"pt",text:"Pages",ui:"menu",handler:CreatePages});btnarchive=new Ext.Button({itemId:"Archive",style:"font-size:"+fontsize+"pt",text:"Archive",ui:"menu",handler:CreateArchive});btnforward=new Ext.Button({itemId:"Forward",style:"font-size:"+fontsize+"pt",text:">",ui:"menu",handler:goForward});btnfastforward=new Ext.Button({itemId:"FastForward",style:"font-size:"+fontsize+"pt",text:">>",ui:"menu",handler:goLast});btnbackward=new Ext.Button({itemId:"Backward",style:"font-size:"+fontsize+"pt",text:"<",ui:"menu",handler:goBack});btnfastbackward=new Ext.Button({itemId:"FastBackward",style:"font-size:"+fontsize+"pt",text:"<<",ui:"menu",handler:goFirst});var a="";if(islandscape()){if(pageno%2>0){a=pageno-1+"-"+pageno}else{a=pageno+"-"+(pageno+1)}if(nopages==pageno)a=pageno;if(pageno==1)a=1}txtpagenumber=new Ext.Button({itemId:"PageNo",width:islandscape()==false?80*devicemultiple:140*devicemultiple,text:islandscape()==false?pageno+"/"+lblpages:a+"/"+lblpages,style:"text-align:center;font-size:"+fontsize+"pt",ui:"normal",listeners:{tap:function(a,b){setTimeout("LookForChangedValue()",100);window.plugins.downloader.texts(function(a){},function(a){})}}});txtpagenumberno=new Ext.form.Number({itemId:"PageNo",width:islandscape()==false?80*devicemultiple:140*devicemultiple,value:islandscape()==false?pageno+"/"+lblpages:a+"/"+lblpages,style:"text-align:center;font-size:"+fontsize+"pt",ui:"normal",listeners:{focus:function(a,b){a.setValue("");disableresize=true},blur:function(a,b){value=a.getValue();if(value<1)value="1";if(value>nopages)value=nopages;a.setValue(value);SetPageNo(value);currentpage=a.getValue();a.setValue(currentpage+"/"+nopages);disableresize=false},keyup:function(a,b){var c=b.which?b.which:event.keyCode;var d=a.getValue();if(c>31&&(c<48||c>57))a.setValue(d.substr(0,d.length-1))}}});tbar.doComponentLayout();if(pnlMain.getWidth()<=358*devicemultiple){console.log("Adding tool 1");tbar.add(btnmenu);tbar.add(btnbackward);if(targetos=="android")tbar.add(txtpagenumber);else tbar.add(txtpagenumberno);tbar.add(btnforward);tbar.add(btnpages)}else if(pnlMain.getWidth()<=378*devicemultiple){console.log("Adding tool 1.5");tbar.add(btnmenu);tbar.add(btnbackward);if(targetos=="android")tbar.add(txtpagenumber);else tbar.add(txtpagenumberno);tbar.add(btnforward);tbar.add(btnarchive)}else if(pnlMain.getWidth()<=480*devicemultiple){console.log("Adding tool 1.8");tbar.add(btnmenu);tbar.add({xtype:"spacer"});tbar.add(btnfastbackward);tbar.add(btnbackward);if(targetos=="android")tbar.add(txtpagenumber);else tbar.add(txtpagenumberno);tbar.add(btnforward);tbar.add(btnfastforward);tbar.add({xtype:"spacer"});tbar.add(btnpages)}else if(pnlMain.getWidth()<=555*devicemultiple){console.log("Adding tool 2");tbar.add(btnmenu);tbar.add({xtype:"spacer"});tbar.add(btnfastbackward);tbar.add(btnbackward);if(targetos=="android")tbar.add(txtpagenumber);else tbar.add(txtpagenumberno);tbar.add(btnforward);tbar.add(btnfastforward);tbar.add({xtype:"spacer"});tbar.add(btnpages)}else if(pnlMain.getWidth()<=670*devicemultiple){console.log("Adding tool 3");tbar.add(btnmenu);tbar.add({xtype:"spacer"});tbar.add(btnpages);tbar.add({xtype:"spacer"});tbar.add(btnbackward);if(targetos=="android")tbar.add(txtpagenumber);else tbar.add(txtpagenumberno);tbar.add(btnforward);tbar.add({xtype:"spacer"});tbar.add(Searchbox)}else if(pnlMain.getWidth()<=760*devicemultiple){console.log("Adding tool 4");tbar.add(btnmenu);tbar.add({xtype:"spacer"});tbar.add(btnpages);tbar.add({xtype:"spacer"});tbar.add(btnfastbackward);tbar.add(btnbackward);if(targetos=="android")tbar.add(txtpagenumber);else tbar.add(txtpagenumberno);tbar.add(btnforward);tbar.add(btnfastforward);tbar.add({xtype:"spacer"});tbar.add(Searchbox)}else{console.log("Adding tool 5");tbar.add(btnmenu);tbar.add(btnarchive);tbar.add(btnpages);tbar.add({xtype:"spacer"});tbar.add(btnfastbackward);tbar.add(btnbackward);if(targetos=="android")tbar.add(txtpagenumber);else tbar.add(txtpagenumberno);tbar.add(btnforward);tbar.add(btnfastforward);tbar.add({xtype:"spacer"});tbar.add(Searchbox)}tbar.doLayout();tbar.doComponentLayout()};var getwidth=function(a){var b=lblpageratio;var c=a*b;c=Math.floor(c);return c};var checkpagenumberzoomedin=function(a,b){var c=getwidth(imagezoomlevel);var d=b;if(islandscape()){if(b>1){d--}}if(a>=c){d++}return d};var loadtiles=function(a,b,c){var d=a/256;var e=b/256;var f=Math.floor(d);var g=Math.floor(e);d=Math.floor(d)*256;e=Math.floor(e)*256;var h="";var i=a+c.getWidth();var j=b+c.getHeight();var k=d;var l=f;var m=g;var n=getwidth(imagezoomlevel);var o=false;while(e<j){while(k<i){if(k>n){if(o==false){k=n;o=true;l=0}}var p="<img style = 'position:absolute;left:"+k+"px;top:"+e+"px' src = 'http://pages.mobile.cdn.pagesuite.com/images/"+pagestore.data.items[checkpagenumberzoomedin(k,pageno)-1].data["pageguid"]+"/"+l.toString()+"-"+m.toString()+".jpg'/>";h+=p;k+=256;l++}k=d;e+=256;l=f;m++;o=false}c.body.dom.firstChild.innerHTML=htmlcontainer+h;createlinks(c)};var zoomout=function(){iszoomedin=false;if(zoomedinview!=null){zoomedinview.destroy();zoomedinview=null}pnlMain.show();pnlPaper.show();ignorecardswitch=false;SetCards(carouselpart)};var zoominofflinesize=0;var zoominoffline=function(a,b,c){if(c==1){zoominofflinesize=1100}else{zoominofflinesize=imagezoomlevel}var d=a/pnlPaper.getWidth();var e=b/heightofpanel;if(zoomedinview){d=a/zoomedinview.getWidth();e=b/zoomedinview.getHeight();zoomedinview.destroy()}iszoomedin=true;htmlcontainer="<img id = 'img' style = 'height:"+zoominofflinesize+"px;position:absolute;top:0px;left:0px' src = '"+offlinepath+"'/>";if(c==2){htmlcontainer="<img id = 'img' style = 'position:absolute;top:0px;left:0px' src = '"+offlinepath+"'/>"}if(islandscape()){if(pageno>1&&pageno<parseInt(nopages)){htmlcontainer="<img id = 'img' style = 'height:"+zoominofflinesize+"px;position:absolute;top:0px;left:0px' src = '"+offlinepath2+"'/>";htmlcontainer+="<img id = 'img2' style = 'height:"+zoominofflinesize+"px;position:absolute;top:0px;left:"+getwidth(zoominofflinesize)+"px' src = '"+offlinepath+"'/><div style = 'clear:both'></div>";if(c==2){htmlcontainer="<img id = 'img' style = 'position:absolute;top:0px;left:0px' src = '"+offlinepath2+"?changed=yes'/>";htmlcontainer+="<img id = 'img2' style = 'position:absolute;top:0px;left:"+getwidth(zoominofflinesize)+"px' src = '"+offlinepath+"?changed=yes'/><div style = 'clear:both'></div>"}}}console.log(htmlcontainer);zoomedinview=new Ext.Panel({fullscreen:true,scroll:{direction:"both"},html:htmlcontainer,listeners:{afterrender:function(a){createlinks(a);pnlPaper.hide();pnlMain.hide();var b=getwidth(zoominofflinesize);var f=zoominofflinesize;if(islandscape()){if(pageno>1){b=b*2}else if(pageno==1){}}var g=b*d;var h=f*e;g=g-a.getWidth()/2;h=h-a.getHeight()/2;if(islandscape()){if(pageno==1){g=g-a.getWidth()/2}}if(g<0)g=0;if(h<0)h=0;var i=b-a.getWidth();if(g>i)g=i;var j=f-a.getHeight();h=Math.floor(h*1);j=Math.floor(j*1);var k=parseInt(h);var l=parseInt(j);if(k>l){h=j}var m=new Ext.util.Offset(0-g,0-h);this.scroller.setOffset(m,false);this.mon(this.el,{tap:function(a){if(this.delayedTask==null){this.delayedTask=new Ext.util.DelayedTask(function(){this.delayedTask=null},this);this.delayedTask.delay(100)}},doubletap:function(a){if(this.delayedTask!=null){this.delayedTask.cancel();this.delayedTask=null}if(c==2){zoomout()}else{zoominoffline(a.pageX,a.pageY,2)}},scope:this})}}})};var zoominonline=function(a,b){zoominofflinesize=1e3;var c=a/pnlPaper.getWidth();var d=b/heightofpanel;iszoomedin=true;htmlcontainer="<img id = 'img' style = 'height:"+zoominofflinesize+"px;position:absolute;top:0px;left:0px' src = '"+onlinepath+"'/>";if(islandscape()){if(pageno>1&&pageno<parseInt(nopages)){htmlcontainer="<img id = 'img' style = 'height:"+zoominofflinesize+"px;position:absolute;top:0px;left:0px' src = '"+onlinepath2+"'/>";htmlcontainer+="<img id = 'img2' style = 'height:"+zoominofflinesize+"px;position:absolute;top:0px;left:"+getwidth(zoominofflinesize)+"px' src = '"+onlinepath+"'/><div style = 'clear:both'></div>"}}console.log(htmlcontainer);zoomedinview=new Ext.Panel({fullscreen:true,scroll:{direction:"both"},html:htmlcontainer,listeners:{afterrender:function(a){pnlPaper.hide();pnlMain.hide();createlinks(a);var b=getwidth(zoominofflinesize);var e=zoominofflinesize;if(islandscape()){if(pageno>1){b=b*2}else if(pageno==1){}}var f=b*c;var g=e*d;f=f-a.getWidth()/2;g=g-a.getHeight()/2;if(islandscape()){if(pageno==1){f=f-a.getWidth()/2}}if(f<0)f=0;if(g<0)g=0;var h=b-a.getWidth();if(f>h)f=h;var i=e-a.getHeight();g=Math.floor(g*1);i=Math.floor(i*1);var j=parseInt(g);var k=parseInt(i);if(j>k){g=i}var l=new Ext.util.Offset(0-f,0-g);this.scroller.setOffset(l,false);this.mon(this.el,{tap:function(a){if(this.delayedTask==null){this.delayedTask=new Ext.util.DelayedTask(function(){this.delayedTask=null},this);this.delayedTask.delay(100)}},doubletap:function(a){if(this.delayedTask!=null){this.delayedTask.cancel();this.delayedTask=null}zoominonlinelarge(a.pageX,a.pageY)},scope:this})}}})};var zoominonlinelarge=function(a,b){var c=a/pnlPaper.getWidth();var d=b/heightofpanel;if(zoomedinview){c=a/zoomedinview.getWidth();d=b/zoomedinview.getHeight();zoomedinview.destroy()}iszoomedin=true;htmlcontainer="<img id = 'img' style = 'height:"+imagezoomlevel+"px;position:absolute;top:0px;left:0px' src = '"+onlinepath+"'/>";if(islandscape()){if(pageno>1&&pageno<parseInt(nopages)){htmlcontainer="<img id = 'img' style = 'height:"+imagezoomlevel+"px;position:absolute;top:0px;left:0px' src = '"+onlinepath2+"'/>";htmlcontainer+="<img id = 'img2' style = 'height:"+imagezoomlevel+"px;position:absolute;top:0px;left:"+getwidth(imagezoomlevel)+"px' src = '"+onlinepath+"'/><div style = 'clear:both'></div>"}}console.log(htmlcontainer);zoomedinview=new Ext.Panel({fullscreen:true,scroll:{direction:"both"},html:htmlcontainer,listeners:{afterrender:function(a){pnlPaper.hide();pnlMain.hide();var b=getwidth(imagezoomlevel);var e=imagezoomlevel;if(islandscape()){if(pageno>1){b=b*2}else if(pageno==1){}}var f=b*c;var g=e*d;f=f-a.getWidth()/2;g=g-a.getHeight()/2;if(islandscape()){if(pageno==1){f=f-a.getWidth()/2}}if(f<0)f=0;if(g<0)g=0;var h=b-a.getWidth();if(f>h)f=h;var i=e-a.getHeight();g=Math.floor(g*1);i=Math.floor(i*1);var j=parseInt(g);var k=parseInt(i);if(j>k){g=i}loadtiles(f,g,a);var l=new Ext.util.Offset(0-f,0-g);this.scroller.setOffset(l,false);this.scroller.on("scrollstart",function(){this.delayedTasks=null});this.scroller.on("scrollend",function(){if(this.delayedTasks==null){this.delayedTasks=new Ext.util.DelayedTask(function(){loadtiles(a.scroller.getOffset().x,a.scroller.getOffset().y,a);this.delayedTasks=null},this);this.delayedTasks.delay(1e3)}});this.mon(this.el,{tap:function(a){if(this.delayedTask==null){this.delayedTask=new Ext.util.DelayedTask(function(){this.delayedTask=null},this);this.delayedTask.delay(100)}},doubletap:function(a){if(this.delayedTask!=null){this.delayedTask.cancel();this.delayedTask=null}zoomout()},scope:this})}}})};var SetArchive=function(a){a=a-1;cache1pageno=-1;cache2pageno=-1;cache3pageno=-1;carind1=-1;carind2=-1;carind3=-1;lbleditionguid=editionstore.data.items[a].data["editionguid"];lblname=editionstore.data.items[a].data["name"];lblpages=editionstore.data.items[a].data["pages"];nopages=parseInt(editionstore.data.items[a].data["pages"]);overlay.hide();ignorecardswitch=true;LaunchSplashPanel();GetPDFInfo()};var SetPageNo=function(a){ignorecardswitch=true;if(islandscape()){if(a%2==0&&parseInt(a)!=parseInt(nopages)){a++}}if(a<pageno){pageno=a;carouselpart.layout.prev({type:"slide",reverse:true},true)}else if(a>pageno){pageno=a;carouselpart.layout.next({type:"slide"},true)}else{}};var wecangooffline=function(){if(localStorage.getItem(pagestore.data.items[pageno-1].data["pageguid"])){var a=true;if(islandscape()){if(pageno>1&&pageno<nopages){if(pageno%2>0){if(!localStorage.getItem(pagestore.data.items[pageno-2].data["pageguid"])){a=false;console.log("Not all pages downloaded")}}else{if(!localStorage.getItem(pagestore.data.items[pageno].data["pageguid"])){a=false;console.log("Not all pages downloaded")}}}}if(a){return true}else{return false}}else{return false}};var MovePage=function(){pageno=0;nextpageno=parseInt(localStorage.getItem("readpageno"));cache1pageno=-1;cache2pageno=-1;cache3pageno=-1;carind1=-1;carind2=-1;carind3=-1;SetPageNo(parseInt(localStorage.getItem("readpageno")))};var CheckPage=function(){if(localStorage.getItem("readeditionguid")){if(localStorage.getItem("readeditionguid")==lbleditionguid){if(localStorage.getItem("readpageno")){if(parseInt(localStorage.getItem("readpageno"))>pageno){setTimeout("MovePage()",1e3)}}}}};var preventswitch=function(){preventswitching=false};var CreateReader=function(){CheckPage();hascreatedreader=true;var a=40*devicemultiple;fontsize=14*devicemultiple;tbar=new Ext.Toolbar({xtype:"toolbar",dock:"top",height:a});CreateToolbar();panelsubpanel1=new Ext.Panel({html:"",centered:true,listeners:{afterrender:function(a){}}});panelsubpanel2=new Ext.Panel({html:""});panelsubpanel3=new Ext.Panel({html:""});var b=1;if(pnlPaper){pnlMain.remove(pnlPaper,true)}pnlPaper=new Ext.Panel({cls:"card1",id:"tab1",title:"Paper",iconCls:"paper",style:"background-color:white",dockedItems:{dock:"top",items:[tbar]},fullscreen:true,layout:{type:"vbox",align:"stretch"},defaults:{flex:1},items:[{xtype:"carousel",indicator:false,wrap:true,preventScroll:true,listeners:{cardswitch:{fn:function(a,b,c,d,e){if(!preventswitching){console.log("MOVING CARD");moving=false;pagechanges(a,b,c,d,e);preventswitching=true;setTimeout("preventswitch()",500)}}},beforecardswitch:function(a,b,c,d,e){if(preventswitching){return false}console.log("Switching");moving=true;if(zoominnow){}else{DisableButtons();this.delayedTasks=null}},aftershow:function(a){},afterrender:function(a){carouselpart=a;if(delayedTask==null){delayedTask=new Ext.util.DelayedTask(function(){SetCards(this);delayedTask=null},this);delayedTask.delay(500)}this.mon(this.el,{tap:function(a){if(!moving){console.log("Tap");if(delayedTask2==null){console.log("Just One Tap");delayedTask2=new Ext.util.DelayedTask(function(){delayedTask2=null},this);delayedTask2.delay(100)}}},doubletap:function(a){if(!moving){console.log("Double Tap");if(delayedTask2!=null){delayedTask2.cancel();delayedTask2=null}zoominnow=false;if(a.pageY>44){if(iszoomedin!=true){if(wecangooffline()){if(widths>=768){zoominoffline(a.pageX,a.pageY,2)}else{zoominoffline(a.pageX,a.pageY,1)}}else{if(widths>=768&&!islandscape()||widths>=1024&&islandscape()){zoominonlinelarge(a.pageX,a.pageY)}else{if(targetos==""){zoominonlinelarge(a.pageX,a.pageY)}else{zoominonline(a.pageX,a.pageY)}}}}}}},scope:this})}},items:[panelsubpanel1,panelsubpanel2,panelsubpanel3]}]});if(targetos!=""){pnlMain.insert(2,pnlPaper);if(supportstabpanel){if(hashomebutton){pnlMain.setActiveItem(2)}else{pnlMain.setActiveItem(1)}}}cache1pageno=-1;cache2pageno=-1;cache3pageno=-1;carind1=-1;carind2=-1;carind3=-1;pageno=1;DownloadFinished("DoubleTap");DisplayReader()};var HideElements=function(){var a=document.getElementById("canvland0");if(a!=null){a.style.display="none"}a=document.getElementById("canv0");if(a!=null){a.style.display="none"}a=document.getElementById("canvland1");if(a!=null){a.style.display="none"}a=document.getElementById("canv1");if(a!=null){a.style.display="none"}a=document.getElementById("canvland2");if(a!=null){a.style.display="none"}a=document.getElementById("canv2");if(a!=null){a.style.display="none"}a=document.getElementById("spinnerland0");if(a!=null){a.style.display="none"}a=document.getElementById("spinner0");if(a!=null){a.style.display="none"}a=document.getElementById("spinnerland1");if(a!=null){a.style.display="none"}a=document.getElementById("spinner1");if(a!=null){a.style.display="none"}a=document.getElementById("spinnerland2");if(a!=null){a.style.display="none"}a=document.getElementById("spinner2");if(a!=null){a.style.display="none"}};var CheckPageNoLandscape=function(a,b){if(a>1&&a<nopages){return true}else{return false}};var GetWidth=function(){var a=lblpageratio;var b=GetHeight()*a;return b};var GetHeight=function(){var a=lblpageratio;var b=heightofpanel*a;b=Math.floor(b);if(islandscape()==true){b=b*2}var c=heightofpanel;if(b>widths){if(islandscape()){c=Math.floor(widths/2/a)}else{c=Math.floor(widths/a)}}return c};var GetPageX=function(a){var b=lblpageratio;var c=GetHeight()*b;c=Math.floor(c);var d=c;if(islandscape()==true){d=d*2}var e=Math.floor((widths-d)/2);if(islandscape()){if(a%2==1){e=e+c}}return e};var GetPositionSpinnerX=function(a){var b=lblpageratio;var c=GetHeight()*b;c=Math.floor(c);var d=c;if(islandscape()){d=d*2}var e=Math.floor((widths-d)/2+c/2);if(islandscape()){if(a%2==1){e=e+c}}return e};var DisableButtons=function(){var a=tbar.getComponent("Forward");if(a)a.setDisabled(true);a=tbar.getComponent("Backward");if(a)a.setDisabled(true);a=tbar.getComponent("FastForward");if(a)a.setDisabled(true);a=tbar.getComponent("FastBackward");if(a)a.setDisabled(true)};var ResetButtons=function(){var a=tbar.getComponent("Forward");if(a)a.setDisabled(false);a=tbar.getComponent("Backward");if(a)a.setDisabled(false);a=tbar.getComponent("FastForward");if(a)a.setDisabled(false);a=tbar.getComponent("FastBackward");if(a)a.setDisabled(false);if(pageno==1){var a=tbar.getComponent("FastBackward");if(a)a.setDisabled(true);a=tbar.getComponent("Backward");if(a)a.setDisabled(true)}if(pageno==parseInt(lblpages)){var a=tbar.getComponent("Forward");if(a)a.setDisabled(true);a=tbar.getComponent("FastForward");if(a)a.setDisabled(true)}};var SetPaths=function(){onlinepath="http://pages.mobile.cdn.pagesuite.com/images/"+pagestore.data.items[pageno-1].data["pageguid"]+"/"+(pnlPaper.getHeight()>200?"tablet.jpg":"phone.jpg");offlinepath=offlineprepath+pagestore.data.items[pageno-1].data["pageguid"]+".jpg";var a=false;var b=false;if(localStorage.getItem(pagestore.data.items[pageno-1].data["pageguid"])){a=true}if(pageno-2>=0){if(localStorage.getItem(pagestore.data.items[pageno-2].data["pageguid"])){b=true}onlinepath2="http://pages.mobile.cdn.pagesuite.com/images/"+pagestore.data.items[pageno-2].data["pageguid"]+"/"+(pnlPaper.getHeight()>200?"tablet.jpg":"phone.jpg");offlinepath2=offlineprepath+pagestore.data.items[pageno-2].data["pageguid"]+".jpg"}};var ManipulateImage=function(){heights=heightofpanel;console.log(heights);onlinepath="http://pages.mobile.cdn.pagesuite.com/images/"+pagestore.data.items[pageno-1].data["pageguid"]+"/"+(pnlPaper.getHeight()>200?"tablet.jpg":"phone.jpg");offlinepath=offlineprepath+pagestore.data.items[pageno-1].data["pageguid"]+".jpg";var a=false;var b=false;console.log(a);if(localStorage.getItem(pagestore.data.items[pageno-1].data["pageguid"])){a=true}if(pageno-2>=0){if(localStorage.getItem(pagestore.data.items[pageno-2].data["pageguid"])){b=true}onlinepath2="http://pages.mobile.cdn.pagesuite.com/images/"+pagestore.data.items[pageno-2].data["pageguid"]+"/"+(pnlPaper.getHeight()>200?"tablet.jpg":"phone.jpg");offlinepath2=offlineprepath+pagestore.data.items[pageno-2].data["pageguid"]+".jpg"}$(function(){$("div.canv").each(function(){var c=$(this);var d="";switch(c.data("type")){case"port":if(a==true){d=offlinepath;console.log("Here4")}else{d=onlinepath;console.log("Here3")}break;case"land":if(b==true){d=offlinepath2;console.log("Here2")}else{console.log("Here");d=onlinepath2}break}console.log(d+" Image src");if(supportsToDataURL()){var e=$(this),f=$('<canvas width="'+e.data("width")+'px" height="'+e.data("height")+'px"></canvas>'),g=$("<img></img>",{src:f[0].toDataURL("image/jpg"),alt:"","class":"img",id:e.data("id"),css:{position:"absolute",left:e.data("left")+"px",height:+GetHeight()+"px",width:GetWidth()+"px","background-image":"url("+d+")"}});e.replaceWith(g)}else{var e=$(this),g=$("<img></img>",{src:d,alt:"","class":"img",id:e.data("id"),css:{position:"absolute",left:e.data("left")+"px",height:+GetHeight()+"px",width:GetWidth()+"px"}});e.replaceWith(g)}})})};var addvideopanel=function(a,b,c){console.log("Hitting");var d=(iszoomedin==true?getwidth(imagezoomlevel):GetWidth())*(b.data["x"]/100);var e=(iszoomedin==true?imagezoomlevel:GetHeight())*(b.data["y"]/100);var f=(iszoomedin==true?getwidth(imagezoomlevel):GetWidth())*(b.data["w"]/100);var g=(iszoomedin==true?imagezoomlevel:GetHeight())*(b.data["h"]/100);if(islandscape()){if(c%2>0){d+=iszoomedin==true?getwidth(imagezoomlevel):GetWidth()}if(iszoomedin==false){var h=pnlMain.getWidth()-GetWidth()*2;h=h/2;d+=h}}else{if(iszoomedin==false){var h=pnlMain.getWidth()-GetWidth();h=h/2;d+=h}}var i=b.data["url"].indexOf("watch?v=");var j=b.data["url"].substr(i+8,i.length);var k=new Ext.Panel({width:f,height:g,style:"z-index:1111;position:absolute;top:"+e+"px;left:"+d+"px",html:"<iframe title='YouTube video player' width='"+f+"' height='"+g+"' src='http://www.youtube.com/embed/"+j+"' frameborder='0' allowfullscreen></iframe>"});a.add(k);a.doLayout();var l=new Ext.Button({width:50,height:20,ui:"small",style:"z-index:4111;position:absolute;top:"+(e-20)+"px;left:"+(d-50+f)+"px",text:"Close",handler:function(){this.destroy();k.destroy()}});a.add(l);a.doLayout();videoscontainer.add(l);videoscontainer.add(k);console.log(b.data["url"]+" added")};var addlinkpanel=function(a,b,c){console.log("Hitting");var d=(iszoomedin==true?getwidth(imagezoomlevel):GetWidth())*(b.data["x"]/100);var e=(iszoomedin==true?imagezoomlevel:GetHeight())*(b.data["y"]/100);var f=(iszoomedin==true?getwidth(imagezoomlevel):GetWidth())*(b.data["w"]/100);var g=(iszoomedin==true?imagezoomlevel:GetHeight())*(b.data["h"]/100);if(islandscape()){if(c%2>0){d+=iszoomedin==true?getwidth(imagezoomlevel):GetWidth()}if(iszoomedin==false){var h=pnlMain.getWidth()-GetWidth()*2;h=h/2;d+=h}}else{if(iszoomedin==false){var h=pnlMain.getWidth()-GetWidth();h=h/2;d+=h}}if(b.data["url"].indexOf("liveadvert")>0){var i=new Ext.Panel({width:f,height:g,style:"z-index:1111;position:absolute;top:"+e+"px;left:"+d+"px",html:"<div style = 'width:"+f+"px;overflow:hidden;height:"+g+"px'><iframe title='YouTube video player' width='"+f+"' height='"+g+"' src='"+b.data["url"]+"' frameborder='0' allowfullscreen></iframe><div>"});a.add(i);a.doLayout();var j=new Ext.Button({width:50,height:20,ui:"small",style:"z-index:4111;position:absolute;top:"+(e-20)+"px;left:"+(d-50+f)+"px",text:"Close",handler:function(){this.destroy();i.destroy()}});a.add(j);a.doLayout();videoscontainer.add(j);videoscontainer.add(i)}else{var i=new Ext.Panel({width:f,height:g,style:"z-index:1111;position:absolute;top:"+e+"px;left:"+d+"px",html:" ",listeners:{afterrender:function(a){this.mon(this.el,{tap:function(a){if(IsNumeric(b.data["url"])){SetPageNo(parseInt(b.data["url"]))}else if(b.data["url"].indexOf("@")>0){window.location="mailto:"+b.data["url"],"_blank"}else{window.open(b.data["url"],"_blank")}},scope:this})}}});a.add(i);a.doLayout();videoscontainer.add(i)}console.log(b.data["url"]+" added")};var createlinks=function(a){videoscontainer.removeAll(true);linkstore.data.each(function(){if(this.data["page"]==parseInt(pageno)){addlinkpanel(a,this,pageno)}if(islandscape()){if(this.data["page"]==parseInt(pageno-1)){addlinkpanel(a,this,pageno-1)}}});videostore.data.each(function(){if(this.data["page"]==parseInt(pageno)){addvideopanel(a,this,pageno)}if(islandscape()){if(this.data["page"]==parseInt(pageno-1)){addvideopanel(a,this,pageno-1)}}})};var SetCards=function(a){HideElements();oldcardno=a.getActiveIndex();if(islandscape()){if(pageno%2==0){if(parseInt(pageno)<nopages){oldportpageno=pageno;pageno++}}}else{if(oldportpageno!=0){pageno=oldportpageno}}if(islandscape()){if(pageno>1&&pageno<nopages){txtpagenumber.setText(pageno-1+"-"+pageno+"/"+nopages);txtpagenumberno.setValue(pageno-1+"-"+pageno+"/"+nopages)}else if(pageno<nopages){txtpagenumber.setText(pageno+"/"+nopages);txtpagenumberno.setValue(pageno+"/"+nopages)}else{txtpagenumber.setText(pageno+"/"+nopages);txtpagenumberno.setValue(pageno+"/"+nopages)}}else{txtpagenumber.setText(pageno+"/"+nopages);txtpagenumberno.setValue(pageno+"/"+nopages)}var b="<img id = 'spinnerhih' src = 'loadingspinnerbig.gif' style = 'position:absolute;top:"+(GetHeight()/2-64)+"px;left:"+(GetPositionSpinnerX(pageno)-64)+"px' /><div data-width='"+GetWidth()+"' data-height='"+GetHeight()+"' data-left='"+GetPageX(pageno)+"' data-type='port' data-top='0' class = 'canv' data-id='canvhih'></div>";var c="<img id = 'spinnerlandhih' src = 'loadingspinnerbig.gif' style = 'position:absolute;top:"+(GetHeight()/2-64)+"px;left:"+(GetPositionSpinnerX(pageno-1)-64)+"px' /><div data-width='"+GetWidth()+"' data-height='"+GetHeight()+"' data-left='"+GetPageX(pageno-1)+"' data-type='land' data-top='0' class = 'canv' data-id='canvlandhih'></div>";ResetButtons();switch(a.getActiveIndex()){case 0:var d=b.replace(new RegExp("hih","g"),"0");if(pageno==cache1pageno){var e=document.getElementById("canv0");e.style.display=""}if(a.getWidth()>a.getHeight()){if(CheckPageNoLandscape(pageno,nopages)){if(pageno==cache1pageno){e=document.getElementById("canvland0");e.style.display=""}else{d=c.replace(new RegExp("hih","g"),"0");d+=b.replace(new RegExp("hih","g"),"0")}}}if(carind1!=pageno){panelsubpanel1.removeAll(true);panelsubpanel1.update(d);ManipulateImage();cache1pageno=pageno}else{SetPaths()}createlinks(panelsubpanel1);carind1=pageno;break;case 1:var d=b.replace(new RegExp("hih","g"),"1");if(pageno==cache2pageno){var e=document.getElementById("canv1");e.style.display=""}if(a.getWidth()>a.getHeight()){if(CheckPageNoLandscape(pageno,nopages)){if(pageno==cache2pageno){e=document.getElementById("canvland1");e.style.display=""}else{d=c.replace(new RegExp("hih","g"),"1");d+=b.replace(new RegExp("hih","g"),"1")}}}if(carind2!=pageno){panelsubpanel2.removeAll(true);panelsubpanel2.update(d);ManipulateImage();cache2pageno=pageno}else{SetPaths()}createlinks(panelsubpanel2);carind2=pageno;break;case 2:var d=b.replace(new RegExp("hih","g"),"2");if(pageno==cache3pageno){var e=document.getElementById("canv2");e.style.display=""}if(a.getWidth()>a.getHeight()){if(CheckPageNoLandscape(pageno,nopages)){if(pageno==cache3pageno){e=document.getElementById("canvland2");e.style.display=""}else{d=c.replace(new RegExp("hih","g"),"2");d+=b.replace(new RegExp("hih","g"),"2")}}}if(carind3!=pageno){panelsubpanel3.removeAll(true);panelsubpanel3.update(d);ManipulateImage();cache3pageno=pageno}else{SetPaths()}createlinks(panelsubpanel3);carind3=pageno;break}if(targetos=="android"){var f="Reader";if(localStorage.getItem(pagestore.data.items[pageno-1].data["pageguid"])){f="Download"}window.plugins.downloader.fireOmniture(lblname,pageno,f,function(a){},function(a){})}};var getDistance=function(a){return Math.sqrt(Math.pow(Math.abs(a.targetTouches[0].screenX-a.targetTouches[1].screenX),2)+Math.pow(Math.abs(a.targetTouches[0].screenY-a.targetTouches[1].screenY),2))};var SavePage=function(){downloaditem=pageno-1;var a=true;if(startdownloading){DownloadFinished("Already");a=false}else{if(localStorage.getItem(pagestore.data.items[pageno-1].data["pageguid"])){if(pageno>1&&pageno<nopages){if(islandscape()){if(pageno%2>0){if(localStorage.getItem(pagestore.data.items[pageno-2].data["pageguid"])){a=false;downloaditem=pageno-2;DownloadFinished("Exists")}}else{if(localStorage.getItem(pagestore.data.items[pageno].data["pageguid"])){a=false;downloaditem=pageno;DownloadFinished("Exists")}}}}}}if(a){startdownloading=true;downloadaction=5;if(targetos=="HP"){HPApp.$.downloader.call({target:"http://pages.mobile.cdn.pagesuite.com/images/"+pagestore.data.items[downloaditem].data["pageguid"]+"/full.jpg",targetDir:offlineprepath,targetFilename:pagestore.data.items[downloaditem].data["pageguid"]+".jpg",keepFilenameOnRedirect:true})}else{AndroidFinished(4)}popup=new Ext.Panel({floating:true,centered:true,width:240,height:165,styleHtmlContent:true,scroll:"vertical",html:"<p>This page will appear in your downloads section.</p>",dockedItems:[{dock:"top",xtype:"toolbar",title:"Saving........"}],listeners:{afterrender:function(a){timeoutpopup=setTimeout("KillPopup()",1500)},afterhide:function(a){a.destroy();a=null}}});popup.show("pop")}};var DownloadFinished=function(a){if(popup){if(popup.isVisible()){clearTimeout(timeoutpopup);popup.hide(false)}}var b;var c;if(a=="Success"){b="Finished";c="<p>Your download has now finished.</p>"}else if(a=="DoubleTap"){b="Navigation";c="<p>Please double tap on the page to 'Zoom In'.</p>"}else if(a=="Delete"){b="Delete";c="<p>Your data has now been deleted</p>"}else if(a=="Already"){b="Download";c="<p>File(s) are already being downloaded.</p>"}else if(a=="Exists"){b="Error";c="<p>This page has already been saved.</p>"}else if(a=="Disabled"){b="Download";c="<p>This option is disabled whilst background downloading.</p>"}else{b="Error";c="<p>An error occured whilst your download was taking place.</p>"}popupfinished=new Ext.Panel({floating:true,centered:true,width:240,height:165,styleHtmlContent:true,scroll:"vertical",html:c,dockedItems:[{dock:"top",xtype:"toolbar",title:b}],listeners:{afterrender:function(a){timeoutpopupfinished=setTimeout("KillPopupFinished()",4500)},afterhide:function(a){a.destroy();a=null}}});popupfinished.show("pop")};var KillPopupFinished=function(){popupfinished.hide()};var KillPopup=function(){popup.hide()};var EmailLink=function(){if(targetos==""){document.location="mailto:?subject="+lblpubname+" - "+lblname+" - Page "+pageno+"&body="+encodeURIComponent("http://edition.pagesuite-professional.co.uk/launch.aspx?eid="+lbleditionguid)+"%0D%0A%0D%0ARead online now"}else{var a=lblpubname+" - "+lblname+" - Page "+pageno;var b="http://edition.pagesuite-professional.co.uk/launch.aspx?eid="+lbleditionguid+"&pnum="+pageno+"\n\nDownload the Newsday App from the Marketplace";var c="nathan@pagesuite.com";var d={};if(a&&b&&c){console.log("address: "+c);d[WebIntent.EXTRA_EMAIL]=c;d[WebIntent.EXTRA_SUBJECT]=a;d[WebIntent.EXTRA_TEXT]=b}window.plugins.webintent.startActivity({action:WebIntent.ACTION_SEND,type:"text/plain",extras:d},function(){},function(){Ext.Msg.alert("","Failed to send email")})}};var CreatePDF=function(){var a=heightofpanel;var b=widths;var c=140/a;smallwidth=GetWidth()*c;smallwidth=Math.floor(smallwidth);var d=nopages/2;d=d*5;totalwidth=d+smallwidth*nopages;var e="<img id = 'imgholder' style = 'position:absolute;top:0px;width:"+totalwidth+"px' src = 'blank.png' />";pagecontainer=e;overlaypdf1=new Ext.Panel({floating:true,modal:true,Createdock:"bottom",height:180,hideOnMaskTap:false,width:b,html:e,scroll:"horizontal",ui:"light",listeners:{show:function(a){a.setPosition(a.x||0,a.y||heightofpanel-130)},beforehide:function(a){a.destroy()},afterrender:function(a){RenderPDFPages(a);ScrollersPDF(a);this.scroller.on("scrollend",function(){ScrollersPDF(a)})}}});overlaypdf1.show();var f=function(){document.location="http://psp3.pagesuite.com/make_pdf.aspx?eid="+editionguid+"&pnum="+lblpdfpages};var g=function(){var a=lblpages;var b="";for(i=1;i<=a;i++){var c="chks"+i;var d=document.getElementById(c);d.checked=true;if(b=="")b=i;else b+="|"+i}lblpdfpages=b};var h=function(){var a=lblpages;for(i=1;i<=a;i++){var b="chks"+i;var c=document.getElementById(b);c.checked=false}lblpdfpages=""};var j=function(){overlaypdf1.destroy();overlaypdf2.destroy()};var k=new Ext.Button({text:"Select All",handler:g});var l=new Ext.Button({text:"Select None",handler:h});var m=new Ext.Button({text:"Download",handler:f});var n=new Ext.Button({text:"Close",handler:j});overlaypdf1.show();overlaypdf2=new Ext.Panel({floating:true,modal:true,hideOnMaskTap:false,Createdock:"bottom",height:50,layout:{type:"hbox",pack:"center",align:"stretch"},defaults:{layout:{type:"hbox"},flex:1,defaults:{xtype:"button",cls:"demobtn",flex:1}},width:widths,items:[k,l,m,n],scroll:"horizontal",ui:"light",listeners:{show:function(a){a.setPosition(a.x||0,a.y||heightofpanel-180)},beforehide:function(a){a.destroy()},afterrender:function(a){this.scroller.on("scrollend",function(){})}}});overlaypdf2.show()};var RenderPDFPages=function(a){var b=0;var c=1;html2=pagecontainer;while(b<totalwidth){var d=b+smallwidth/2-14;d=Math.floor(d);html2+="<img style = 'opacity:0.01;position:absolute;top:50px;left:"+d+"px' src = 'loadingspinner.gif' />";if(PageIsSelected(c)){html2+="<input style = 'position:absolute;top:142px;left:"+b+"px' id = 'chks"+c+"' checked = true type = 'checkbox' /><span name = 'spn"+c+"' id = 'spn"+c+"' style = 'width:"+smallwidth+"px;color:gray;position:absolute;top:142px;font-size:10pt; font-weight:bold; left:"+(b+20)+"px;'>Page "+c+"</span>"}else{html2+="<input style = 'position:absolute;top:142px;left:"+b+"px' id = 'chks"+c+"' type = 'checkbox' /><span name = 'spn"+c+"' id = 'spn"+c+"' style = 'width:"+smallwidth+"px;color:gray;position:absolute;top:142px;font-size:10pt; font-weight:bold; left:"+(b+20)+"px;'>Page "+c+"</span>"}b+=smallwidth;if(c%2>0){b+=5}c++}pagecontainer=html2;a.body.dom.firstChild.innerHTML=html2};var PageIsSelected=function(a){var b=false;var c=lblpdfpages;var d=c.split("|");for(i=0;i<d.length;i++){var e=d[i];console.log("Comparing "+e+" and "+a);if(e==a){b=true;break}}console.log(b);return b};var RenderPages=function(a){var b=0;var c=1;html2=pagecontainer;while(b<totalwidth*devicemultiple){var d=b+smallwidth/2-14;d=Math.floor(d);html2+="<img style = 'position:absolute;top:50px;left:"+d+"px' src = 'loadingspinner.gif' />";if(c<=nopages){html2+="<span style = 'width:"+smallwidth+"px;text-align:center; color:gray;position:absolute;top:142px;font-size:10pt; font-weight:bold; left:"+b+"px;'>Page "+c+"</span>";b+=smallwidth*devicemultiple;if(c%2>0){b+=5}c++}else{b=totalwidth*devicemultiple}}pagecontainer=html2;a.update(html2)};var ScrollersPDF=function(a){var b=Ext.get("imgholder");var c=b.getWidth();var d=b.getHeight();var e=1;var f=0;var g=0;var h="";var i=0;var f=0;var e=1;var j="<img id = 'imgholder' style = 'position:absolute;top:0px;width:"+totalwidth+"px' src = 'blank.png' />";while(f<totalwidth){var k=f+smallwidth/2-14;k=Math.floor(k);j+="<img style = 'opacity:0.01;position:absolute;top:50px;left:"+k+"px' src = 'loadingspinner.gif' />";if(PageIsSelected(e)){j+="<input style = 'position:absolute;top:142px;left:"+(f+10)+"px' id = 'chks"+e+"' checked = true type = 'checkbox' /><span name = 'spn"+e+"' id = 'spn"+e+"' style = 'width:"+smallwidth+"px;color:gray;position:absolute;top:142px;font-size:10pt; font-weight:bold; left:"+(f+40)+"px;'>Page "+e+"</span>"}else{j+="<input style = 'position:absolute;top:142px;left:"+(f+10)+"px' id = 'chks"+e+"' type = 'checkbox' /><span name = 'spn"+e+"' id = 'spn"+e+"' style = 'width:"+smallwidth+"px;color:gray;position:absolute;top:142px;font-size:10pt; font-weight:bold; left:"+(f+40)+"px;'>Page "+e+"</span>"}f+=smallwidth;if(e%2>0){f+=5}e++}e=1;f=1;while(f<a.scroller.getOffset().x){i=f;i+=smallwidth;if(e%2>0){i+=5}if(i>a.scroller.getOffset().x){h+="<img name = 'imgspdf"+e+"' id = 'imgspdf"+e+"' src = 'http://edition.pagesuite-professional.co.uk//get_image.aspx?eid="+editionguid+"&pnum="+e+"&h=140' style = 'position:absolute;top:0px;left:"+f+"px;'>"}f=i;e++}var l=a.scroller.getOffset().x+widths;var m=1;while(f<l){h+="<img name = 'imgspdf"+e+"' id = 'imgspdf"+e+"' src = 'http://edition.pagesuite-professional.co.uk//get_image.aspx?eid="+editionguid+"&pnum="+e+"&h=140' style = 'position:absolute;top:0px;left:"+f+"px;'>";f+=smallwidth;if(e%2>0){f+=5}e++}a.body.dom.firstChild.innerHTML=j+h;var n=e-1;e=1;while(e<=n){var o="chks"+(e-1);var p=Ext.get(o);if(p!=null){var q=e-1;p.on("click",function(){SelectPDFPage(this.id.substr(4,this.id.length-4))})}p=null;o="imgspdf"+(e-1);p=Ext.get(o);if(p!=null){var q=e-1;p.on("click",function(){switchcheckbox(this.id.substr(7,this.id.length-7));SelectPDFPage(this.id.substr(7,this.id.length-7))})}o="spn"+(e-1);p=Ext.get(o);if(p!=null){var q=e-1;p.on("click",function(){switchcheckbox(this.id.substr(3,this.id.length-3));SelectPDFPage(this.id.substr(3,this.id.length-3))})}e++}};var SelectPDFPage=function(a){var b="";var c=false;var d=lblpdfpages;var e=d.split("|");for(i=0;i<e.length;i++){var f=e[i];if(f==a){c=true}else{if(b.length>0)b+="|"+f;else b=f}}if(c==false){if(d!="")b+="|"+a;else b=a}lblpdfpages=b};var switchcheckbox=function(a){var b="chks"+a;currentstate=document.getElementById(b);if(currentstate.checked){currentstate.checked=false}else{currentstate.checked=true}};var DestroyPanel=function(){menuoverlay.destroy()};var buttonsSpecTop=[{ui:"back",text:"Back",handler:function(){closeSearch()}}];var toolSearch=new Ext.Toolbar({dock:"top",title:"Search",items:buttonsSpecTop});var closeSearch=function(){pnlSearch.hide();pnlMain.show();if(targetos=="android"){viewport=document.querySelector("meta[name=viewport]");viewport.setAttribute("content","initial-scale=1.0, width=device-width, target-densitydpi=device-dpi,maximum-scale=1.0, user-scalable=no")}if(restorepaper){restorepaper=false;OpenReader();resizereader()}if(targetos=="android"){document.removeEventListener("backbutton",closeSearch,false)}};var OpenSearch=function(){searchtype="e";searchsegmentedButton=new Ext.SegmentedButton({defaults:{flex:1},style:"width: 100%;padding-left:0%",items:[{text:"Search Edition",pressed:searchtype=="e"?true:false},{text:"Search Archive",pressed:searchtype=="p"?true:false}],listeners:{toggle:function(a,b,c){if(c){switch(b.text){case"Search Edition":createsearchlarge(Searchboxsmall,s,"e");break;case"Search Archive":createsearchlarge(Searchboxsmall,s,"p");break}}}}});if(pnlSearch==null){pnlSearch=new Ext.Panel({id:"search",fullscreen:true,dockedItems:[toolSearch],items:[Searchboxsmall,searchsegmentedButton]})}if(pnlPaper.isVisible()){pnlPaper.hide();restorepaper=true}if(targetos=="android"){setTimeout("LookForChangedSearch()",100);window.plugins.downloader.searchtexts(function(a){},function(a){})}pnlMain.hide();pnlSearch.show("slide")};var OpenSearchBox=function(){};var Sections=function(){};var ShowAction=function(){if(!actions){shareTitle=lblpubname+" - "+lblname+" Page "+pageno;shareLink="http://edition.pagesuite-professional.co.uk/launch.aspx?eid="+lbleditionguid+"&pnum="+pageno;actions=new Ext.ActionSheet({items:[{text:"Facebook",handler:function(){postFacebook();actions.hide()}},{text:"Twitter",handler:function(){postToTwitter();actions.hide()}},{text:"Email",handler:function(){EmailLink();actions.hide()}},{text:"Cancel",scope:this,ui:"decline",handler:function(){actions.hide()}}],style:"font-size:"+fontsize+"pt"})}actions.show()};var ShowOptions=function(){listview=new Ext.List({itemTpl:"{Name}",store:targetos==""?onlineoptionsstore:optionsstore,style:"font-size:"+fontsize*.7+"pt",listeners:{itemtap:function(a,b,c,d){console.log("Tapped");switch(b){case 0:targetos==""?EmailLink():startdownload();break;case 1:targetos==""?CreatePDF():SavePage();break;case 2:targetos==""?CreatePDF():OpenSearch();break;case 3:targetos=="Android"?ShowAction():console.log("ss");break}DestroyPanel()}}});menuoverlay=new Ext.Panel({floating:true,Createdock:"bottom",height:targetos==""?100:155*devicemultiple,width:250,items:listview,layout:"fit",scroll:"horizontal",ui:"light",listeners:{beforehide:function(a){a.destroy()}}});menuoverlay.showBy(btnmenu,true,true)};var RenderArchive=function(a){var b=0;var c=1;html2=pagecontainer;var d=lbleditions.split(";");while(b<totalwidth){var e=d[c-1].split(":")[1];if(e!=null){var f=b+smallwidth/2-14;f=Math.floor(f);html2+="<img style = 'position:absolute;top:50px;left:"+f+"px' src = 'loadingspinner.gif' />";html2+="<span style = 'width:"+smallwidth+"px;text-align:center; color:gray;position:absolute;top:142px;font-size:10pt; font-weight:bold; left:"+b+"px;'> "+e+"</span>";b+=smallwidth;b+=10;c++}else{b=totalwidth}}pagecontainer=html2;a.body.dom.firstChild.innerHTML=html2};var ScrollersArchive=function(a){var b=widths;var c=heightofpanel;var d=1;var e=0;var f=0;var g="";var h=0;var i=lbleditions.split(";");while(e<a.scroller.getOffset().x){if(i[d-1].split(":")[0]!=""){var j=i[d-1].split(":")[0].replace(new RegExp("_","g"),"-");h=e;h+=smallwidth;h+=10;if(h>a.scroller.getOffset().x){g+="<img name = 'imgsarc"+d+"' id = 'imgsarc"+d+"' src = 'http://edition.pagesuite-professional.co.uk//get_image.aspx?eid="+j+"&pnum=1&h=140' style = 'position:absolute;top:0px;left:"+e+"px;'>"}e=h;d++}}var k=a.scroller.getOffset().x+widths;var l=1;while(e<k){if(i[d-1].split(":")[0]!=""){var j=i[d-1].split(":")[0].replace(new RegExp("_","g"),"-");g+="<img name = 'imgsarc"+d+"' id = 'imgsarc"+d+"' src = 'http://edition.pagesuite-professional.co.uk//get_image.aspx?eid="+j+"&pnum=1&h=140' style = 'position:absolute;top:0px;left:"+e+"px;'>";e+=smallwidth;e+=10;d++}else{e=k}}a.body.dom.firstChild.innerHTML=pagecontainer+g;var m=d-1;d=1;while(d<=m){var n="imgsarc"+(d-1);var o=Ext.get(n);if(o!=null){var p=d-1;o.on("click",function(){SetArchive(this.id.substr(7,this.id.length-7))})}o=null;d++}};var Scrollers=function(a){var b=widths;var c=heightofpanel;var d=1;var e=0;var f=0;var g="";var h=0;var i=a.scroller.getOffset().x+widths;var j=1;d=1;while(d<=nopages){g+="<img name = 'imgspge"+d+"' id = 'imgspge"+d+"' src = 'http://edition.pagesuite-professional.co.uk//get_image.aspx?eid="+editionguid+"&pnum="+d+"&h=140' style = 'position:absolute;top:0px;left:"+e+"px;'>";e+=smallwidth*devicemultiple;if(d%2>0){e+=5}d++}a.update(pagecontainer+g);var k=d;d=1;while(d<=k){var l="imgspge"+(d-1);var m=Ext.get(l);if(m!=null){var n=d-1;m.on("tap",function(){SetPageNo(this.id.substr(7,this.id.length-7))})}m=null;d++}};var CreatePages=function(){var a=heightofpanel;var b=widths;var c=140/a;smallwidth=GetWidth()*c;smallwidth=Math.floor(smallwidth);var d=nopages/2;d=d*5;totalwidth=d+smallwidth*nopages;var e="<img id = 'imgholder' style = 'position:absolute;top:0px;width:"+totalwidth+"px' src = 'blank.png' />";pagecontainer=e;overlay=new Ext.Panel({floating:true,modal:true,Createdock:"bottom",height:180,width:b,html:e,scroll:"horizontal",ui:"light",listeners:{show:function(a){a.setPosition(a.x||0,a.y||heightofpanel-130)},beforehide:function(a){a.destroy()},afterrender:function(a){RenderPages(a);setTimeout("GoPages()",1e3)}}});overlay.show()};var GoPages=function(){Scrollers(overlay);overlay.doComponentLayout()};var CreateArchive=function(){if(startdownloading){DownloadFinished("Disabled")}else{var a=heightofpanel;var b=widths;changingarchive=true;var c=140/a;smallwidth=GetWidth()*c;smallwidth=Math.floor(smallwidth);var d=lbleditions.split(";");var e=10;totalwidth=e+smallwidth*d.length;var f="<img id = 'imgholder' style = 'position:absolute;top:0px;width:"+totalwidth+"px' src = 'blank.png' />";pagecontainer=f;overlay=new Ext.Panel({floating:true,modal:true,dock:"bottom",height:180,width:b,html:f,scroll:"horizontal",ui:"light",listeners:{show:function(a){a.setPosition(a.x||0,a.y||heightofpanel-130)},beforehide:function(a){a.destroy()},afterrender:function(a){RenderArchive(a);ScrollersArchive(a);this.scroller.on("scrollend",function(){ScrollersArchive(a)})}}});overlay.show()}};var goBack=function(){if(targetos=="HP"){carouselpart.layout.next({type:"slide"},true)}else{carouselpart.layout.prev({type:"slide",reverse:true},true)}};var goForward=function(){if(targetos=="HP"){carouselpart.layout.prev({type:"slide",reverse:true},true)}else{carouselpart.layout.next({type:"slide"},true)}};var goLast=function(){SetPageNo(nopages)};var goFirst=function(){SetPageNo(1)}